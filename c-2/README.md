# MySQLのベンチマーク

## 2.1 ベンチマークを実行する理由

- 負荷がかかってりうときのシステムの振る舞いを観察
- システムのキャパシティを特定
- どの変更が重要であるかを学習
- データを使ってアプリケーションの性能を調べるのに役立つ
- 実際には観察できない架空の状況を作り出せる

ベンチマークでできること

- システムに関する想定を検証し、現実的かどうかを確認
- 解決しようとしているシステムの不正な動作を再現
- アプリケーションの現在のパフォーマンスを計測する
    - 現在の実行速度がわからなければ、変更を加えたとしてもそれが役立つかどうかわからない
    - 過去のベンチマーク結果に基づいて予測していなかった問題を診断
- 実際の稼働環境のシステムが対応できる以上の負荷をシミュレートする
    - システムが成長したときに最初に遭遇するであろうスケーラビリティのボトルネックを特定
- 成長を予測
    - 予測される将来の負荷に必要なハードウェア、ネットワークキャパシティ、その他のリソースがどれくらいか見積もる
    - アップグレードやアプリケーションの大きな変更の際にリスクを低減する
- アプリケーションが環境の変化に対応できるかどうかテストする
    - 散発的なピークが同時に発生した場合のパフォーマンス
    - 別のサーバー設定でのアプリケーションのパフォーマンス
    - アプリケーションが異なるデータ分布をどう扱うか
- 専用のベンチマークでさまざまなハードウェア、ソフトウェア、オペレーティングシステム設定をテストする
    - RAID5とRAID10はどちらがシステムに適しているか
    - ATAディスクからSANストレージに切り替えた場合にランダム書き込みのパフォーマンスはどのように変化するか
    - Linuxの2.4カーネルは2.6カーネルよりもスケーラビリティがあるか
    - MySQLのアップグレードはパフォーマンスの改善に役立つか
    - データに別のストレージエンジンを使用するとどうなるか
- 購入したばかりのハードウェアが正しく設定されていることを確認する
    - ベンチマークを使って新しいシステムで稼働テストを行ったところ、設定上の間違いやハードウェアコンポーネントの不具合がみつかることはよくある
    - 新しいサーバーはベンチマーク実行してからでなければ実際の稼働環境に導入しないのが得策
    - 何がインストールされていて、パフォーマンスがどれくらいかに関して、ホスティングアプリケーションやハードウェアベンダーが言うことを鵜呑みにしてはならない
        - 常にテストを行う
- ベンチマークは現実のものではない
- システムにストレスをかけるためのワークロードは、現実のワークロードに比べてたいてい非常に単純
    - 現実のワークロードは不確定、変動しやすい、すぐには理解できないほど確実
    - システムのベンチマークに現実のワークロードを使用した場合、ベンチマーク結果から正確な結論を引き出すのはかえって難しくなるだろう
- ベンチマークにはデータのサイズやデータとクエリの分析など、人工的な部分がいろいろある
- もっとも重要なのは、ベンチマークが通常はできる限り高速に実行され、システムの正常な動作に支障をきたすほど負荷をかけること
    - 多くの場合は、ベンチマークツールを許容範囲ぎりぎりまで高速に実行し、適度なパフォーマンスを保てるように必要に応じてブレーキをかけることが望ましい
        - 特にシステムの最大有効キャパシティを判定するのに役立つ
    - ほとんどのベンチマークはそのような複雑な設定をサポートしていない
    - 結果の優位性と有効性がツールによって制限される
- キャパシティの計画にベンチマークを利用するのも難しい
    - ベンチマーク結果からの推定値は現実に即していない
    - ワークロード、データ、関係、機能における変化をシミュレートするのは難しく、影響を推測するのは容易ではない
- システムのキャパシティに適度な余裕があるかどうかを知ることを目的として、通常は概算値でよしとする
- 単純で、直接的な比較が可能で、実行コストが低く、実行しやすいのがベンチマーク
- ベンチマークには制限があるが、便利
- 自分が何をしてるのか、結果がどのように有意義なのか自覚できていればよい
